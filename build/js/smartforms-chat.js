(()=>{"use strict";document.addEventListener("DOMContentLoaded",(()=>{const e=window.formData;if(!e||!e.fields||!e.fields.length)return;let t=0;const r={};let a=null;const n=document.getElementById("smartforms-chat-dialog"),o=document.getElementById("smartforms-chat-submit-button"),s=document.getElementById("smartforms-chat-input-box"),l=document.getElementById("smartforms-chat-help-container"),c=(e,t)=>{e.required?o.disabled=!t||"string"==typeof t&&0===t.trim().length||Array.isArray(t)&&0===t.length:o.disabled=!1},i=e=>{s.firstElementChild&&s.firstElementChild.remove(),s.insertBefore(e,s.firstElementChild)},m=()=>{const r=e.fields[t];a=null,(e=>{const t=document.createElement("div");t.classList.add("smartforms-chat-message","bot");const r=document.createElement("p");r.textContent=e,t.appendChild(r),n.appendChild(t),n.scrollTop=n.scrollHeight})(r.label);const o=(e=>{let t;if("text"===e.type)t=document.createElement("input"),t.type="text",t.className="form-control smartforms-text-input",t.placeholder=e.placeholder||"Type your answer here...",t.addEventListener("input",(t=>{c(e,t.target.value)}));else if("checkbox"===e.type)t=document.createElement("div"),t.className="sf-checkbox-group sf-checkbox-group-"+(e.layout||"horizontal"),t.setAttribute("data-layout",e.layout||"horizontal"),e.options&&Array.isArray(e.options)&&e.options.forEach((r=>{const a=document.createElement("div"),n="horizontal"===e.layout?" form-check-inline":"";a.className="sf-checkbox-option form-check"+n;const o=document.createElement("input");o.type="checkbox",o.className="form-check-input",o.value=r.value,o.id=e.id?`${e.id}-${r.value}`:r.value;const s=document.createElement("label");s.className="form-check-label",s.htmlFor=o.id,s.textContent=r.label,a.appendChild(o),a.appendChild(s),t.appendChild(a),o.addEventListener("change",(()=>{const r=Array.from(t.querySelectorAll("input[type='checkbox']")).filter((e=>e.checked)).map((e=>e.value));c(e,r)}))}));else if("select"===e.type)t=document.createElement("select"),t.className="form-control smartforms-select",e.options&&Array.isArray(e.options)&&e.options.forEach((e=>{const r=document.createElement("option");r.value=e.value,r.textContent=e.label,t.appendChild(r)})),t.addEventListener("change",(t=>{c(e,t.target.value)}));else if("slider"===e.type)t=document.createElement("input"),t.type="range",t.className="form-control smartforms-slider",t.min=e.min||0,t.max=e.max||100,t.value=e.value||Math.floor(((e.min||0)+(e.max||100))/2),t.addEventListener("input",(t=>{c(e,t.target.value)}));else if("number"===e.type)t=document.createElement("input"),t.type="number",t.className="form-control smartforms-number",t.placeholder=e.placeholder||"",t.addEventListener("input",(t=>{c(e,t.target.value)}));else{if("buttons"===e.type)return t=document.createElement("div"),t.className="sf-buttons-group d-flex flex-wrap gap-2",e.options&&Array.isArray(e.options)&&e.options.forEach((r=>{const n=document.createElement("button");n.type="button",n.className="btn btn-primary",n.setAttribute("data-value",r.value),n.textContent=r.label,n.addEventListener("click",(()=>{Array.from(t.children).forEach((e=>{e.classList.remove("active")})),n.classList.add("active"),a=r.value,c(e,a)})),t.appendChild(n)})),c(e,a),t;t=document.createElement("textarea"),t.className="form-control smartforms-textarea smartforms-chat-input",t.rows=4,t.placeholder=e.placeholder||"Type your answer here...",t.addEventListener("input",(t=>{c(e,t.target.value)}))}return t})(r);i(o),c(r,a)};m(),o.disabled=!0,o.addEventListener("click",(c=>{c.preventDefault();const d=e.fields[t];let p;if("buttons"===d.type)p=a;else if("checkbox"===d.type){const e=s.querySelectorAll("input[type='checkbox']");p=Array.from(e).filter((e=>e.checked)).map((e=>e.value)),p=p.join(", ")}else if("text"===d.type){const e=s.querySelector("input");if(!e)return;p=e.value}else{const e=s.firstElementChild;if(!e)return;p=e.value}((s,c=s)=>{const d=e.fields[t];if(d.required&&("string"==typeof s&&0===s.trim().length||Array.isArray(s)&&0===s.length||null===s))return l.textContent=d.requiredMessage||`${d.label} is required.`,void l.classList.add("smartforms-error-message");if((e=>{const t=document.createElement("div");t.classList.add("smartforms-chat-message","user");const r=document.createElement("p");r.textContent=e,t.appendChild(r),n.appendChild(t),n.scrollTop=n.scrollHeight})(c),l.textContent=d.helpText||"Enter your help text",l.classList.remove("smartforms-error-message"),r[d.id||t]=s,a=null,t<e.fields.length-1)t++,m();else{const e=new URLSearchParams;e.append("action","process_smartform"),e.append("smartform_nonce",smartformsData.nonce),e.append("form_id",smartformsData.formId||window.smartformsFormId),e.append("form_data",JSON.stringify(r)),fetch(smartformsData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}).then((e=>e.json())).then((e=>{n.innerHTML="";const t=document.createElement("div");if(t.classList.add("smartforms-chat-message","bot"),e.success)t.innerHTML=`<p>${e.data.message}</p>`;else{const r=Array.isArray(e.data)?e.data.join(" "):e.data;t.innerHTML=`<p class="error">${r}</p>`}n.appendChild(t),n.scrollTop=n.scrollHeight;const r=document.createElement("textarea");r.className="form-control smartforms-chat-input",r.rows=4,r.placeholder="Type your message here...",r.disabled=!0,i(r),o.disabled=!0})).catch((e=>{console.error("AJAX submission error:",e)}))}})(p)}))}))})();