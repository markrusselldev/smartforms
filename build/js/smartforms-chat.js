(()=>{"use strict";document.addEventListener("DOMContentLoaded",(()=>{const e=window.formData;if(!e||!e.fields||!e.fields.length)return;let t=0;const r={},o=document.getElementById("smartforms-chat-dialog"),a=document.getElementById("smartforms-chat-submit-button"),n=document.getElementById("smartforms-chat-input-box"),s=e=>{n.firstElementChild&&n.firstElementChild.remove(),n.insertBefore(e,n.firstElementChild)},l=()=>{const r=e.fields[t];o.innerHTML="";const a=document.createElement("div");a.classList.add("smartforms-chat-message","bot");const n=document.createElement("p");n.textContent=r.label,a.appendChild(n),o.appendChild(a),o.scrollTop=o.scrollHeight;const l=(e=>{let t;return"text"===e.type?(t=document.createElement("input"),t.type="text",t.className="form-control smartforms-text-input",t.placeholder=e.placeholder||"Type your answer here..."):"checkbox"===e.type?(t=document.createElement("div"),t.className="sf-checkbox-group sf-checkbox-group-"+(e.layout||"horizontal"),t.setAttribute("data-layout",e.layout||"horizontal"),e.options&&Array.isArray(e.options)&&e.options.forEach((r=>{const o=document.createElement("div");let a="";"horizontal"===e.layout&&(a=" form-check-inline"),o.className="sf-checkbox-option form-check"+a;const n=document.createElement("input");n.type="checkbox",n.className="form-check-input",n.value=r.value,n.id=e.id?e.id+"-"+r.value:r.value;const s=document.createElement("label");s.className="form-check-label",s.htmlFor=n.id,s.textContent=r.label,o.appendChild(n),o.appendChild(s),t.appendChild(o)}))):"select"===e.type?(t=document.createElement("select"),t.className="form-control smartforms-select",e.options&&Array.isArray(e.options)&&e.options.forEach((e=>{const r=document.createElement("option");r.value=e.value,r.textContent=e.label,t.appendChild(r)}))):"slider"===e.type?(t=document.createElement("input"),t.type="range",t.className="form-control smartforms-slider",t.min=e.min||0,t.max=e.max||100,t.value=e.value||Math.floor(((e.min||0)+(e.max||100))/2)):"number"===e.type?(t=document.createElement("input"),t.type="number",t.className="form-control smartforms-number",t.placeholder=e.placeholder||""):(t=document.createElement("textarea"),t.className="form-control smartforms-textarea",t.rows=4,t.placeholder=e.placeholder||"Type your answer here..."),t})(r);if(s(l),r.helpText&&r.helpText.trim().length>0){const e=document.createElement("p");e.className="smartforms-help-text",e.textContent=r.helpText,l.parentNode.insertBefore(e,l.nextSibling)}};l(),a?a.addEventListener("click",(c=>{c.preventDefault();const m=e.fields[t];let i;if("checkbox"===m.type){const e=n.querySelectorAll("input[type='checkbox']");i=Array.from(e).filter((e=>e.checked)).map((e=>e.value))}else if("text"===m.type){const e=n.querySelector("input");if(!e)return;i=e.value}else{const e=n.firstElementChild;if(!e)return;i=e.value}if(m.required&&("checkbox"===m.type&&(!Array.isArray(i)||0===i.length)||"string"==typeof i&&0===i.trim().length)){const e=a.parentElement;if(!e.querySelector(".smartforms-error-message")){const t=document.createElement("span");t.className="smartforms-error-message",t.textContent=m.validationMessage||`${m.label} is required.`,e.insertBefore(t,a)}return}const d=a.parentElement.querySelector(".smartforms-error-message");if(d&&d.remove(),r[m.id||t]=i,t<e.fields.length-1)t++,l();else{const e=new URLSearchParams;e.append("action","process_smartform"),e.append("smartform_nonce",smartformsData.nonce),e.append("form_id",smartformsData.formId||window.smartformsFormId),e.append("form_data",JSON.stringify(r)),fetch(smartformsData.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}).then((e=>e.json())).then((e=>{o.innerHTML="";const t=document.createElement("div");if(t.classList.add("smartforms-chat-message","bot"),e.success)t.innerHTML=`<p>${e.data.message}</p>`;else{const r=Array.isArray(e.data)?e.data.join(" "):e.data;t.innerHTML=`<p class="error">${r}</p>`}o.appendChild(t),o.scrollTop=o.scrollHeight;const r=document.createElement("textarea");r.className="form-control smartforms-chat-input",r.rows=4,r.placeholder="Type your message here...",s(r)})).catch((e=>{console.error("AJAX submission error:",e)}))}})):console.error("Submit button not found in the chat form.")}))})();