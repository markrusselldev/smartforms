(()=>{"use strict";function e(e){return"center"===e?"justify-content-center":"right"===e?"justify-content-end":"justify-content-start"}function t(e,t){e.firstElementChild&&e.firstElementChild.remove(),e.insertBefore(t,e.firstElementChild)}const a=function(){const e=document.getElementById("smartforms-config");if(e)try{return JSON.parse(e.textContent)}catch(e){return console.error("Error parsing smartforms configuration:",e),null}return null}()||{formData:null,ajaxUrl:"",nonce:"",formId:null};document.addEventListener("DOMContentLoaded",(()=>{const{formData:n,ajaxUrl:r,nonce:s,formId:o}=a;if(!n||!n.fields||0===n.fields.length)return void console.error("No form data available for SmartForms chat flow.");let l=0;const c={};let i=null;const d=document.getElementById("smartforms-chat-dialog"),m=document.getElementById("smartforms-chat-submit-button"),u=document.getElementById("smartforms-chat-input-box"),p=document.getElementById("smartforms-chat-help-container");function f(e,t){const a=document.createElement("div");a.classList.add("smartforms-chat-message",t);const n=document.createElement("p");n.textContent=e,a.appendChild(n),d.appendChild(a),d.scrollTop=d.scrollHeight}function h(e,t){if(!e.required)return m.classList.remove("disabled"),void("buttons"===e.type&&(i=t));"buttons"===e.type&&(i=t),null===t||"string"==typeof t&&""===t.trim()||Array.isArray(t)&&0===t.length?m.classList.add("disabled"):m.classList.remove("disabled")}function v(){const a=n.fields[l];i=null,f(a.label,"bot");const r=function(t,a){const n=document.createElement("div");n.className="sf-field-wrapper";const r=document.createElement("div");let s;switch(r.className="sf-input-container",t.type){case"text":{s=document.createElement("div"),s.className="sf-text-container";const e=document.createElement("input");e.type="text",e.className="form-control sf-text-input",e.placeholder=t.placeholder||"Type your answer here...",e.addEventListener("input",(e=>{a(t,e.target.value)})),s.appendChild(e);break}case"number":{const n=e(t.fieldAlignment);r.classList.add("d-flex",n),s=document.createElement("div");const o="small"===t.fieldSize?"form-control-sm":"large"===t.fieldSize?"form-control-lg":"",l=document.createElement("input");l.type="number",l.className=`form-control sf-number-input ${o}`,void 0!==t.min&&(l.min=t.min),void 0!==t.max&&(l.max=t.max),void 0!==t.step&&(l.step=t.step),l.addEventListener("input",(e=>{a(t,e.target.value)})),s.appendChild(l);break}case"checkbox":{const n=t.layout||"horizontal";s=document.createElement("div"),s.className="sf-checkbox-group sf-checkbox-group-"+n,s.setAttribute("data-layout",n),t.options&&Array.isArray(t.options)&&t.options.forEach(((e,r)=>{const o=document.createElement("div"),l="horizontal"===n?" form-check-inline":"";o.className="sf-checkbox-option form-check"+l;const c=document.createElement("input");c.type="checkbox",c.className="form-check-input",c.value=e.value,c.id=`cb-${r}-${(e.value||"").replace(/\s+/g,"-")}`;const i=document.createElement("label");i.className="form-check-label",i.htmlFor=c.id,i.textContent=e.label,c.addEventListener("change",(()=>{const e=Array.from(s.querySelectorAll("input[type='checkbox']")).filter((e=>e.checked)).map((e=>e.value));a(t,e)})),o.appendChild(c),o.appendChild(i),s.appendChild(o)}));const o=e(t.fieldAlignment);r.classList.add("d-flex",o);break}case"buttons":{s=document.createElement("div"),"vertical"===t.layout?(s.className="sf-buttons-group sf-buttons-group--vertical",s.setAttribute("data-layout","vertical")):(s.className="sf-buttons-group sf-buttons-group--horizontal d-flex flex-wrap gap-2",s.setAttribute("data-layout","horizontal")),t.options&&Array.isArray(t.options)&&t.options.forEach((e=>{const n=document.createElement("button");n.type="button",n.className="btn btn-primary",n.setAttribute("data-value",e.value),n.textContent=e.label,n.addEventListener("click",(()=>{if(t.multiple){n.classList.toggle("active");const e=s.querySelectorAll("button.active"),r=Array.from(e).map((e=>e.getAttribute("data-value")));a(t,r)}else Array.from(s.children).forEach((e=>e.classList.remove("active"))),n.classList.contains("active")?(n.classList.remove("active"),a(t,null)):(n.classList.add("active"),a(t,e.value))})),s.appendChild(n)}));const n=e(t.fieldAlignment);r.classList.add("d-flex",n);break}case"slider":{s=document.createElement("div"),s.className="sf-slider-container";const e=document.createElement("input");e.type="range",e.className="sf-slider-input",void 0!==t.min&&(e.min=t.min),void 0!==t.max&&(e.max=t.max),void 0!==t.step&&(e.step=t.step),e.addEventListener("input",(e=>{a(t,e.target.value)})),s.appendChild(e);break}case"select":{s=document.createElement("div"),s.className="sf-select-container";const e=document.createElement("select");e.className="sf-select-input form-control",t.options&&Array.isArray(t.options)&&t.options.forEach((t=>{const a=document.createElement("option");a.value=t.value||t,a.textContent=t.label||t,e.appendChild(a)})),e.addEventListener("change",(e=>{a(t,e.target.value)})),s.appendChild(e);break}case"radio":{s=document.createElement("div"),s.className="sf-radio-group",t.options&&Array.isArray(t.options)&&t.options.forEach(((e,n)=>{const r=document.createElement("div");r.className="sf-radio-option form-check form-check-inline";const o=document.createElement("input");o.type="radio",o.className="form-check-input",o.value=e.value||e,o.id=`radio-${n}-${(e.value||"").replace(/\s+/g,"-")}`,o.name=t.groupName||"sf-radio-group",o.required=t.required;const l=document.createElement("label");l.className="form-check-label",l.htmlFor=o.id,l.textContent=e.label||e,o.addEventListener("change",(()=>{a(t,o.value)})),r.appendChild(o),r.appendChild(l),s.appendChild(r)}));const n=e(t.fieldAlignment);r.classList.add("d-flex",n);break}case"textarea":{s=document.createElement("div"),s.className="sf-textarea-container";const e=document.createElement("textarea");e.className="form-control sf-textarea",e.rows=4,e.placeholder=t.placeholder||"Type your answer here...",e.addEventListener("input",(e=>{a(t,e.target.value)})),s.appendChild(e);break}default:{s=document.createElement("div"),s.className="sf-default-container";const e=document.createElement("textarea");e.className="form-control sf-default-textarea",e.rows=4,e.placeholder=t.placeholder||"Type your answer here...",e.addEventListener("input",(e=>{a(t,e.target.value)})),s.appendChild(e);break}}return r.appendChild(s),n.appendChild(r),n}(a,h);t(u,r),h(a,i)}v(),h(n.fields[l],i),m.addEventListener("click",(e=>{e.preventDefault();const a=n.fields[l];if(a.required&&m.classList.contains("disabled"))return p.textContent=a.requiredMessage||`${a.label} is required.`,p.classList.add("smartforms-error-message"),void setTimeout((()=>{p.textContent=a.helpText||"Enter your help text",p.classList.remove("smartforms-error-message")}),3e3);let h;if("buttons"===a.type)h=i;else if("checkbox"===a.type){const e=u.querySelectorAll("input[type='checkbox']");h=Array.from(e).filter((e=>e.checked)).map((e=>e.value)).join(", ")}else if("radio"===a.type){const e=u.querySelector("input[type='radio']:checked");h=e?e.value:""}else if("number"===a.type){const e=u.querySelector("input[type='number']");if(!e)return;h=e.value}else if("text"===a.type){const e=u.querySelector("input");if(!e)return;h=e.value}else{const e=u.firstElementChild;if(!e)return;h=e.value}!function(e,a=e){const h=n.fields[l];if(h.required&&("string"==typeof e&&""===e.trim()||Array.isArray(e)&&0===e.length||null===e))return p.textContent=h.requiredMessage||`${h.label} is required.`,p.classList.add("smartforms-error-message"),void setTimeout((()=>{p.textContent=h.helpText||"Enter your help text",p.classList.remove("smartforms-error-message")}),3e3);if(f(a,"user"),p.textContent=h.helpText||"Enter your help text",p.classList.remove("smartforms-error-message"),c[h.id||l]=e,i=null,l<n.fields.length-1)l++,v();else{const e=new URLSearchParams;e.append("action","process_smartform"),e.append("smartform_nonce",s),e.append("form_id",o),e.append("form_data",JSON.stringify(c)),fetch(r,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e.toString()}).then((e=>e.json())).then((e=>{d.innerHTML="";const a=document.createElement("div");if(a.classList.add("smartforms-chat-message","bot"),e.success)a.innerHTML=`<p>${e.data.message}</p>`;else{const t=Array.isArray(e.data)?e.data.join(" "):e.data;a.innerHTML=`<p class="error">${t}</p>`}d.appendChild(a),d.scrollTop=d.scrollHeight;const n=document.createElement("textarea");n.className="form-control smartforms-chat-input",n.rows=4,n.placeholder="Type your message here...",n.disabled=!0,t(u,n),m.classList.add("disabled")})).catch((e=>{console.error("AJAX submission error:",e)}))}}(h)}))}))})();